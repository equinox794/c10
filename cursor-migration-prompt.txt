GÃ–REV: Mevcut Bioplant CRM projesini production-ready Vercel + Supabase yapÄ±sÄ±na migrate et.

## MEVCUT DURUM
- Backend: Express.js (backend/server.js) - 1728 satÄ±r, SQLite veritabanÄ±
- Frontend: Next.js 14 (frontend/ klasÃ¶rÃ¼)
- Database: SQLite (backend/database.sqlite)
- Ã‡alÄ±ÅŸma: Local (localhost:3001 backend, localhost:3000 frontend)

## HEDEF YAPI
- Frontend: Vercel'de deploy edilecek Next.js uygulamasÄ±
- Backend: Vercel Serverless Functions (API Routes)
- Database: Supabase PostgreSQL

## YAPILACAK Ä°ÅLER

### 1. DATABASE MIGRATION (Supabase)
- backend/database.sqlite'daki tÃ¼m tablolarÄ± analiz et (customers, stock, recipes, orders, packages, settings, recipe_items vb.)
- Supabase iÃ§in SQL migration dosyasÄ± oluÅŸtur: `supabase/migrations/001_initial_schema.sql`
- SQLite'Ä±n tÃ¼m tablolarÄ±nÄ±, constraintlerini, indexlerini PostgreSQL formatÄ±na Ã§evir
- Seed data varsa `supabase/seed.sql` oluÅŸtur
- Supabase setup iÃ§in `supabase/.env.example` dosyasÄ± oluÅŸtur (SUPABASE_URL, SUPABASE_ANON_KEY, SUPABASE_SERVICE_ROLE_KEY)

### 2. BACKEND REFACTORING (Serverless Functions)
- backend/server.js'deki tÃ¼m Express route'larÄ± Vercel API Routes formatÄ±na Ã§evir
- Her endpoint iÃ§in ayrÄ± dosya oluÅŸtur: `frontend/app/api/[endpoint]/route.js`
- Ã–rnek:
  - GET/POST /api/customers â†’ frontend/app/api/customers/route.js
  - GET/PUT/DELETE /api/customers/[id] â†’ frontend/app/api/customers/[id]/route.js
  - /api/stock, /api/recipes, /api/orders vs. iÃ§in aynÄ± yapÄ±
- SQLite db.run, db.all, db.get yerine Supabase client kullan
- Middleware'leri (cors, auth) Next.js API routes'a uyarla
- PDF generation (pdfGenerator.js) ve file upload (multer) fonksiyonlarÄ±nÄ± serverless'a uyarla

### 3. FRONTEND GÃœNCELLEMELERÄ°
- Frontend'deki tÃ¼m API Ã§aÄŸrÄ±larÄ±nÄ± kontrol et (process.env.NEXT_PUBLIC_API_ORIGIN kullanÄ±mÄ±)
- API Ã§aÄŸrÄ±larÄ±nÄ± relative path'e Ã§evir (http://localhost:3001/api/customers â†’ /api/customers)
- Supabase real-time Ã¶zelliklerini ekle (opsiyonel ama Ã¶nerilir)
- Environment variables'Ä± .env.local ve .env.example'a ekle

### 4. YENÄ° KLASÃ–R YAPISI OLUÅTUR
```
/
â”œâ”€â”€ frontend/                    (mevcut frontend, ama gÃ¼ncellenmiÅŸ)
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/                (YENÄ° - Backend routes buraya taÅŸÄ±nacak)
â”‚   â”‚   â”‚   â”œâ”€â”€ customers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ route.js
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/route.js
â”‚   â”‚   â”‚   â”œâ”€â”€ stock/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ route.js
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/route.js
â”‚   â”‚   â”‚   â”œâ”€â”€ recipes/
â”‚   â”‚   â”‚   â”œâ”€â”€ orders/
â”‚   â”‚   â”‚   â”œâ”€â”€ packages/
â”‚   â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ (existing pages)
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ supabase.js         (YENÄ° - Supabase client)
â”‚   â”œâ”€â”€ .env.local              (YENÄ° - local env vars)
â”‚   â”œâ”€â”€ .env.example            (YENÄ° - template)
â”‚   â””â”€â”€ vercel.json             (YENÄ° - Vercel config)
â”œâ”€â”€ supabase/                   (YENÄ° KLASÃ–R)
â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â””â”€â”€ 001_initial_schema.sql
â”‚   â”œâ”€â”€ seed.sql
â”‚   â””â”€â”€ .env.example
â”œâ”€â”€ backend/                    (ESKÄ° - referans iÃ§in kalsÄ±n, sonra silinebilir)
â””â”€â”€ README.md                   (GÃœNCELLE - yeni setup talimatlarÄ±)
```

### 5. SUPABASE CLIENT SETUP
frontend/lib/supabase.js oluÅŸtur:
```javascript
import { createClient } from '@supabase/supabase-js'

export const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
)

// Server-side iÃ§in
export const supabaseAdmin = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.SUPABASE_SERVICE_ROLE_KEY
)
```

### 6. API ROUTE Ã–RNEÄÄ°
Mevcut Express route'u:
```javascript
app.get('/api/customers', async (req, res) => {
  const customers = await dbAll('SELECT * FROM customers');
  res.json(customers);
});
```

Yeni Vercel API route'a Ã§evir (frontend/app/api/customers/route.js):
```javascript
import { NextResponse } from 'next/server';
import { supabase } from '@/lib/supabase';

export async function GET(request) {
  const { data, error } = await supabase
    .from('customers')
    .select('*');

  if (error) return NextResponse.json({ error: error.message }, { status: 500 });
  return NextResponse.json(data);
}

export async function POST(request) {
  const body = await request.json();
  const { data, error } = await supabase
    .from('customers')
    .insert([body])
    .select();

  if (error) return NextResponse.json({ error: error.message }, { status: 500 });
  return NextResponse.json(data[0]);
}
```

TÃœM backend/server.js route'larÄ± iÃ§in bu dÃ¶nÃ¼ÅŸÃ¼mÃ¼ yap.

### 7. PACKAGE.JSON GÃœNCELLEMELERÄ°
frontend/package.json'a ekle:
```json
{
  "dependencies": {
    "@supabase/supabase-js": "^2.39.0"
  }
}
```

### 8. ENVIRONMENT FILES
.env.example oluÅŸtur:
```
# Supabase
NEXT_PUBLIC_SUPABASE_URL=your-project-url.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Vercel (otomatik ayarlanÄ±r)
VERCEL_URL=
```

### 9. VERCEL.JSON
vercel.json oluÅŸtur:
```json
{
  "buildCommand": "cd frontend && npm run build",
  "outputDirectory": "frontend/.next",
  "framework": "nextjs",
  "regions": ["iad1"]
}
```

### 10. README.md GÃœNCELLE
Yeni setup adÄ±mlarÄ±nÄ± ekle:
- Supabase projesi nasÄ±l oluÅŸturulur
- Environment variables nasÄ±l ayarlanÄ±r
- Vercel'e nasÄ±l deploy edilir
- Migration nasÄ±l Ã§alÄ±ÅŸtÄ±rÄ±lÄ±r

### 11. DEPLOYMENT DOKÃœMANI
DEPLOYMENT.md oluÅŸtur ve ÅŸunlarÄ± aÃ§Ä±kla:
1. Supabase projesi oluÅŸturma
2. Migrations Ã§alÄ±ÅŸtÄ±rma (Supabase Dashboard veya CLI)
3. Vercel'e GitHub repo baÄŸlama
4. Environment variables ayarlama
5. Deploy yapma

### 12. Ã–ZEL DURUMLAR
- PDF generation: pdfkit'i serverless function'da kullan, gerekirse edge-compatible alternatif bul
- File upload: Vercel Blob Storage veya Supabase Storage kullan
- Excel import/export: xlsx kÃ¼tÃ¼phanesini API route'da kullan
- Long-running tasks varsa: Vercel'in 10 saniye limiti var, uzun iÅŸlemler iÃ§in background job sistemi Ã¶ner

## Ã–NEMLI NOTLAR
1. TÃ¼m SQLite sorgularÄ± PostgreSQL'e uyumlu olmalÄ± (DATETIME â†’ TIMESTAMP, AUTOINCREMENT â†’ SERIAL vb.)
2. Transaction kullanÄ±mlarÄ±nÄ± PostgreSQL formatÄ±na Ã§evir
3. Error handling ekle (Supabase error responses)
4. CORS ayarlarÄ± Next.js API routes'da gerekli deÄŸil
5. TÃ¼m hassas bilgiler environment variables'da olmalÄ±

## SON ADIMLAR
1. TÃ¼m deÄŸiÅŸiklikleri test et
2. Migration guide oluÅŸtur
3. .gitignore gÃ¼ncelle (.env.local, .vercel, .supabase vb.)
4. Git commit ve push yap
5. KullanÄ±cÄ±ya deploy talimatlarÄ± ver

## OUTPUT
Ä°ÅŸlem bittiÄŸinde bana ÅŸunlarÄ± ver:
1. âœ… Tamamlanan gÃ¶revler listesi
2. ğŸ“ Supabase migration SQL dosyasÄ±
3. ğŸ“ Deployment adÄ±mlarÄ± (step-by-step)
4. ğŸ“ Environment variables listesi
5. âš ï¸ Manuel yapÄ±lmasÄ± gereken iÅŸlemler (Supabase proje oluÅŸturma vb.)

BaÅŸla ve tÃ¼m migration iÅŸlemini tamamla. Her adÄ±mÄ± aÃ§Ä±kla ve ilerlemeyi raporla.
